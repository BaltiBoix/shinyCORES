{
    "contents" : "require(openxlsx, quietly = TRUE)\nrequire(dplyr, quietly = TRUE)\nrequire(zoo, quietly = TRUE)\nrequire(tidyr, quietly = TRUE)\n\nxls.file<-\"../CORES/consumos.xlsx\"\n\ndownload.file(\"http://www.cores.es/sites/default/files/archivos/estadisticas/consumos-pp-ccaa-provincias.xlsx\", \n              xls.file, mode = \"wb\")\ndf<-read.xlsx(\"../CORES/consumos.xlsx\", sheet=\"Consumos\", startRow = 6)\ndf<-filter(df, Año > 1997 & Año < 2020)\ndf<-select(df, -contains(\"bio\"))\nnames(df)<-c(\"Anyo\",\"Mes\",\"CCAA\",\"Provincia\",\"GS97\",\"GS95\",\"GS98\",\"GOA\",\"GOB\",\"GOC\",\"FOBIA\")\n\ndf<-mutate(df, fecha=as.yearmon(paste0(Mes,Anyo)))\ndf<-select(df, c(12,3:11))\ndf[is.na(df)] <- 0\ndf[,4:10]<-df[,4:10]/1000\nsaveRDS(df, file = '../shinyCORES/data/consumos-pp-ccaa-provincias.RDS')\n\n\nxls.file<-\"../CORES/consumos-pp.xlsx\"\n\ndownload.file(\"http://www.cores.es/sites/default/files/archivos/estadisticas/consumos-pp.xlsx\", \n              xls.file, mode = \"wb\")\n\ndftemp<-read.xlsx(xls.file, sheet=\"GLPs\", startRow = 6)\ndftemp<-filter(dftemp, Mes != \"\")\nnames(dftemp)<-c(\"anyo\", \"mes\", \"GLP.envasado\", \"GLP.granel\", \"GLP.automocion\", \"GLP.otros\", \"GLP.total\")\n\npp.df<-dftemp\n\ndftemp<-read.xlsx(xls.file, sheet = \"Gasolinas\", startRow = 6, cols = 1:11)\ndftemp<-filter(dftemp, Mes != \"\")\nnames(dftemp)<- c('anyo','mes','GSNA.GS97','GSNA.GS95','GSNA.GS98','GSNA.bioetanol','GSNA.mezcla',\n                  'GSNA.auto','GSNA.aviacion','GSNA.otras','GSNA.total')\n\npp.df<-merge(pp.df, dftemp)\n\ndftemp<-read.xlsx(xls.file, sheet = \"Querosenos\", startRow = 6, cols = 1:5)\ndftemp<-filter(dftemp, Mes != \"\")\nnames(dftemp)<- c('anyo','mes','KERO.aviacion','KERO.otros','KERO.total')\n\npp.df<-merge(pp.df, dftemp)\n\ndftemp<-read.xlsx(xls.file, sheet = \"Gasoleos\", startRow = 6, cols = 1:10)\ndftemp<-filter(dftemp, Mes != \"\")\nnames(dftemp)<- c('anyo','mes','GOIL.goa','GOIL.biodiesel','GOIL.biomezcla',\n                  'GOIL.auto','GOIL.gob','GOIL.goc','GOIL.otros','GOIL.total')\n\npp.df<-merge(pp.df, dftemp)\n\ndftemp<-read.xlsx(xls.file, sheet = \"Fueloleos\", startRow = 6, cols = 1:7)\ndftemp<-filter(dftemp, Mes != \"\")\nnames(dftemp)<- c('anyo','mes','FUEL.fo1','FUEL.fo2','FUEL.fobia',\n                  'FUEL.otros','FUEL.total')\n\npp.df<-merge(pp.df, dftemp)\n\ndftemp<-read.xlsx(xls.file, sheet = \"Otros Productos\", startRow = 6, cols = 1:7)\ndftemp<-filter(dftemp, Mes != \"\")\nnames(dftemp)<- c('anyo','mes','OTROS.lubricantes','OTROS.asfalto',\n                  'OTROS.coque','OTROS.otros','OTROS.total')\n\npp.df<-merge(pp.df, dftemp)\n\npp.df<- pp.df %>% \n      mutate_each(funs(ch2num = ifelse(is.na(.), NA, as.numeric(.))), -c(1:2)) %>%\n      filter(mes != \"total\") %>%\n      mutate(fecha = as.yearmon(paste(mes, anyo))) %>%\n      arrange(fecha) %>%\n      select(fecha, everything()) %>%\n      mutate_each(funs(consumo2kt=ifelse(is.na(.), NA, ./1000)), -c(1:3))\n\nsaveRDS(pp.df, file = '../shinyCORES/data/consumos-pp.RDS') \n",
    "created" : 1460398441867.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "477597978",
    "id" : "4DEA8970",
    "lastKnownWriteTime" : 1460399517,
    "path" : "~/RProjects/CORES/ShinyRDS.R",
    "project_path" : null,
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 14,
    "source_on_save" : false,
    "type" : "r_source"
}